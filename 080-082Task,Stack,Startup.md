### task,stack,startup-mode

#### 目的
* Activityのタスク、スタックの仕組みを理解

#### ゴール
* タスクについて簡単に説明できる。
* アクティビティスタックについて簡単に説明できる。
* 4種類あるアクティビティの起動モードによりどのような動きをするのかを説明できる。

---
#### タスクとスタック
##### タスクとは
* 関連するActivityの集合をスタック構造で管理するActivityの集合体

##### スタック
* アプリケーション内のタスクをスタック構造で管理するタスクの集合体

#### Activityの起動モード
* 参考にしたサイト http://niudev.blogspot.jp/2013/02/androidlaunchmode.html

##### standard
* デフォルトの起動モード
新しいIntentに応答するたびに、新しいインスタンスが生成される
生成されたActivityは、タスクがすでに存在すればそこに入り、なければタスクを生成する

A->B->C->D->Cの場合<br>
タスクがあればそこに入り、なければ新しくタスクを生成する

##### singleTop
* 新しいIntentに応答するとき、もし自身のActivityが「現在のタスクにあり、かつ最上位」である場合にそのインスタンスを再利用します。
* それ以外の条件の場合は新たにインスタンスを生成します

A->B->C->D->Cの場合、CがsingleTopとすると<br>
A->B->C->D<br>
　　　^　|<br>
　　　|__|<br>

* このとき、CのActivityはonCreateではなく**onNewIntent**で呼ばれる
* このときのスタックは<br>

\---------------<br>
　|A-B-C|<br>
\---------------<br>

##### singleTask
* 新しいIntentに応答するとき、もし自身のActivityが同タスク内に存在する場合にそのインスタンスを再利用します。
* 呼び出されたActivityは必ずrootActivityになります。
* A→C→D→Cで呼んだ場合CがsingleTaskとすると、

|A|<br>
 ┗ーーーーー＞ |C - D|<br>
　　　　　　　^  　|<br>
　　　　　　　┗＿」

* このときのスタックは<br>

\---------------<br>
| A | C | <br>
\---------------<br>

##### singleInstance
* 新しいIntentに応答するとき、自身がルートかつ、ほかのActivityは含めないタスクを生成します。

#### タスクのクリア
* ユーザーがタスクを長時間放置すると、タスクのルートアクティビティを除くすべてのアクティビティがクリアされます。

#### タスクアフィニティ
* affinity:親和性
* 同じアプリ内で起動したActivityにはすべて親和性があり、基本的に同じタスクの中に存在しようとする。
* Manifestのactivity要素のtaskAffinity属性を使用して、アクティビティごとに個別の親和性を設定することもできる
* つまり、別々のアプリケーションで定義されているアクティビティで親和性を共有したり、同じアプリケーションで定義されているアクティビティに別々の親和性を割り当てたりできる

##### 状況
* アクティビティを起動するIntentオブジェクトにFLAG_ACTIVITY_NEW_TASKフラグが含まれている場合
  * IntentにFLAG_ACTIVITY_NEW_TASKフラグを設定すると、startActivityで起動したActivityを別のタスクに入れようとする。
  * 大抵は新しいタスクに積まれますが、activityタグに設定したtaskAffinityが同じActivityがあれば、そちらのタスクにスタックされる

* アクティビティのallowTaskReparenting 属性が "true" に設定されている場合
  * allowTaskReparenting属性が"true"に設定されているアクティビティは、そのアクティビティと親和性のあるタスクがフォアグラウンドに移ったときに、アクティビティを開始したタスクから親和性のあるタスクに移動


---
### 確認問題
* タスクとはなんですか？
  * 関連するActivityの集合をスタック構造で管理するActivityの集合体
* スタックとはなんですか？
  * アプリケーション内のタスクをスタック構造で管理するタスクの集合体
* A→B→C→D(singleInstance)→C→Dの順で呼び出した場合のタスクとスタックの状態を答えてください。
  * タスク：A→B→C⇄D
  * スタック：A-B-C|C|D
